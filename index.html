<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assignment 1</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <script src="map.js"></script>
  <style>
    body {
      text-align: center;
      /* Center the text horizontally */
    }

    body,
    html {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>


</head>

<body style="background-color: #f0f0f0;">

  <h1>MIDDLE EARTH MAP</h1>

  <script>

    /*Inspiration / Source: https://observablehq.com/@d3/zoom-to-bounding-box?intent=fork

    design flaws:
    -no easy way to zoom back if you click in the middle of the country
    -dragging has no limits
    -zooming in/out on different locations causes weird effects

  
    */
    // Add an SVG



    // Add Rectangles
    // Add Circles
    // Add Lines
    // Add Polygons

    const viewportWidth = document.documentElement.clientWidth;
    const viewportHeight = document.documentElement.clientHeight;

    // Margins set to prevent drifting of box
    const margin = { top: 100, right: 450, bottom: 100, left: 450 };
    const width = viewportWidth - margin.left - margin.right;
    const height = viewportHeight - margin.top - margin.bottom;


    const imgWidth = 3200;
    const imgHeight = 2400;


    // Create SVG
    var svg = d3.select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("viewBox", `0 0 ${imgWidth} ${imgHeight}`)
      .attr("preserveAspectRatio", "xMidYMid meet");



    const g = svg.append("g");

    const zoom = d3.zoom()
      .scaleExtent([1, 3])
      .translateExtent([[0, 0], [imgWidth, imgHeight]]) //used to ensure zooming out doesn't land in the ocean of nothingness

      .on("zoom", handleZoom);

    svg.call(zoom);




    var map = g.append("image")
      .attr("href", "LOTRHighRes.jpeg")
      .attr("width", 3200)
      .attr("height", 2400)
      .attr("x", 0)
      .attr("y", 0)
      .on("click", reset);


    const starPoints = [
      [0, -50],
      [14, -14],
      [50, 0],
      [14, 14],
      [0, 50],
      [-14, 14],
      [-50, 0],
      [-14, -14],
    ];
    function drawMapCoord(name, x, y) {
      g.append("polygon")
        .attr("id", name)
        .attr("points", starPoints.map(point => point.join(',')).join(' '))
        .attr("transform", "translate(" + x + "," + y + ")")
        .attr("fill", "orange")
        .attr("stroke", "black")
        .attr("stroke-width", 5)
        .on("click", function (event) {
          locationClicked(this, name, x, y);
        });
    }

    drawMapCoord("TheShire", 900, 700);



    function handleZoom(event) {
      console.log(event.transform);
      g.attr("transform", event.transform);
    }

    //used from the source
    function reset() {
      svg.transition().duration(750).call(
        zoom.transform,
        d3.zoomIdentity,
        d3.zoomTransform(svg.node()).invert([width / 2, height / 2])
      );
    }



    //created to zoom to a specific element
    
    function locationClicked(item, name, x, y) {
      d3.select(item).transition().style("fill", "red");
      let svgElement = d3.select("#" + name).node();

      //Math performed by ChatGPT
      svg.transition().duration(750).call(
        zoom.transform,
      d3.zoomIdentity.translate(imgWidth / 2, imgHeight / 2).scale(3).translate(-x, -y)
      );
    }




  </script>
</body>

</html>